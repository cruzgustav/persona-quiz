<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minha Vitrine | Vortek</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Anima√ß√£o de Entrada */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cores Din√¢micas (Podem vir do App) */
        :root { --primary: #e11d48; --primary-light: #ffe4e6; }
        .text-primary { color: var(--primary); }
        .bg-primary { background-color: var(--primary); }
        .bg-primary-light { background-color: var(--primary-light); }
        .border-primary { border-color: var(--primary); }
    </style>
</head>
<body class="pb-24">

    <header class="bg-white shadow-sm pt-8 pb-4 px-6 rounded-b-3xl relative z-10">
        <div class="flex items-center gap-4">
            <div class="relative">
                <img id="profile-img" src="https://ui-avatars.com/api/?name=Loja+Demo&background=e11d48&color=fff" 
                     class="w-16 h-16 rounded-full border-4 border-white shadow-lg object-cover">
                <div class="absolute -bottom-1 -right-1 bg-green-500 w-5 h-5 rounded-full border-2 border-white"></div>
            </div>
            <div>
                <h1 id="store-name" class="text-xl font-bold text-slate-800 leading-tight">Carregando...</h1>
                <p id="store-desc" class="text-sm text-slate-500">Cole√ß√£o Exclusiva</p>
            </div>
        </div>
        
        <div id="promo-banner" class="hidden mt-4 bg-primary-light py-2 px-4 rounded-lg flex items-center gap-2">
            <i class="ph ph-confetti text-primary text-xl"></i>
            <p class="text-xs font-bold text-primary">Frete Gr√°tis acima de R$ 200</p>
        </div>
    </header>

    <main class="px-4 mt-6">
        <div class="flex justify-between items-end mb-4 px-2">
            <div>
                <span class="text-xs font-bold tracking-widest text-slate-400 uppercase">Cole√ß√£o</span>
                <h2 id="collection-title" class="text-2xl font-black text-slate-800">Destaques</h2>
            </div>
            <span id="item-count" class="text-xs font-bold bg-slate-200 text-slate-600 px-2 py-1 rounded-md">0 itens</span>
        </div>

        <div id="products-grid" class="grid grid-cols-2 gap-4 pb-10">
            </div>
    </main>

    <div class="fixed bottom-6 left-0 right-0 px-6 z-50">
        <button onclick="contactStore()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-xl flex items-center justify-center gap-3 active:scale-95 transition-transform">
            <i class="ph ph-whatsapp-logo text-2xl text-green-400"></i>
            Falar com Vendedora
        </button>
    </div>

    <script>
        // --- DADOS PADR√ÉO (FALLBACK) ---
        // Isso aparece se o link n√£o tiver dados, servindo de "Demo"
        const defaultData = {
            profile: {
                name: "Loja Demo",
                desc: "Moda & Estilo",
                avatar: "", // Se vazio, usa gerador
                whatsapp: "5511999999999"
            },
            collection: "Ver√£o 2026 ‚òÄÔ∏è",
            config: {
                enable_voting: true, // Fun√ß√£o 1: Pedir Opini√£o
                enable_coupon: true, // Fun√ß√£o 2: Cupom Viral
                promo_text: "Frete Gr√°tis hoje!"
            },
            products: [
                { id: 1, name: "Vestido Midi Floral", price: "199,90", color: "#fca5a5" },
                { id: 2, name: "Conjunto Linho", price: "249,90", color: "#fde047" },
                { id: 3, name: "Blusa Seda", price: "89,90", color: "#93c5fd" }
            ]
        };

        let currentData = defaultData;

        // --- 1. CARREGAMENTO DOS DADOS (URL PARAMS) ---
        function loadData() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('data');

            if (encodedData) {
                try {
                    // Decodifica Base64 -> JSON
                    const jsonString = atob(encodedData);
                    // Decodifica caracteres especiais (UTF-8)
                    const decodedString = decodeURIComponent(escape(jsonString));
                    currentData = JSON.parse(decodedString);
                } catch (e) {
                    console.error("Erro ao ler dados da URL", e);
                }
            }
            renderPage();
        }

        // --- 2. RENDERIZA√á√ÉO DA P√ÅGINA ---
        function renderPage() {
            // Perfil
            document.getElementById('store-name').innerText = currentData.profile.name;
            document.getElementById('store-desc').innerText = currentData.profile.desc || "Vitrine Virtual";
            if (currentData.profile.avatar) {
                document.getElementById('profile-img').src = currentData.profile.avatar;
            }

            // Banner Config
            if (currentData.config.promo_text) {
                const banner = document.getElementById('promo-banner');
                banner.classList.remove('hidden');
                banner.querySelector('p').innerText = currentData.config.promo_text;
            }

            // Cole√ß√£o
            document.getElementById('collection-title').innerText = currentData.collection;
            document.getElementById('item-count').innerText = `${currentData.products.length} itens`;

            // Produtos
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '';

            currentData.products.forEach(p => {
                // Se a cor for Hex, usa bg-color. Se for URL, usa img.
                const isImage = p.color && (p.color.startsWith('http') || p.color.startsWith('data:'));
                const bgStyle = isImage ? `background-image: url('${p.color}'); background-size: cover;` : `background-color: ${p.color || '#eee'};`;

                // Bot√£o de Vota√ß√£o (Se ativo na config)
                const voteBtn = currentData.config.enable_voting ? `
                    <button onclick="askFriend('${p.name}')" class="mt-3 w-full bg-pink-50 border border-pink-200 text-pink-600 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 active:bg-pink-100">
                        <i class="ph ph-chat-circle-dots text-lg"></i>
                        Pedir Opini√£o
                    </button>
                ` : '';

                const html = `
                    <div class="bg-white p-3 rounded-2xl shadow-sm border border-slate-100 fade-in">
                        <div class="h-40 w-full rounded-xl mb-3 relative" style="${bgStyle} background-position: center;">
                            <button class="absolute top-2 right-2 bg-white/80 p-1.5 rounded-full shadow-sm text-slate-400 hover:text-red-500">
                                <i class="ph ph-heart-straight text-lg"></i>
                            </button>
                        </div>
                        <h3 class="font-bold text-slate-800 text-sm leading-tight mb-1 truncate">${p.name}</h3>
                        <p class="text-slate-500 text-xs mb-2">R$ ${p.price}</p>
                        
                        ${voteBtn}
                    </div>
                `;
                grid.innerHTML += html;
            });
        }

        // --- 3. FUN√á√ïES VIRAIS ---

        function askFriend(productName) {
            // A m√°gica viral: Gera mensagem para amiga
            const storeUrl = window.location.href; // Link da vitrine atual
            const text = `Amiga, me ajuda! üòç\n\nT√¥ muito em d√∫vida se levo o *${productName}*.\n\nD√° uma olhada aqui e me fala o que acha:\n${storeUrl}`;
            
            // Abre WhatsApp Nativo
            const waLink = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(waLink, '_blank');
        }

        function contactStore() {
            const text = `Ol√°! Vi a cole√ß√£o *${currentData.collection}* e gostei de algumas pe√ßas.`;
            const waLink = `https://wa.me/${currentData.profile.whatsapp}?text=${encodeURIComponent(text)}`;
            window.open(waLink, '_blank');
        }

        // Inicia
        window.onload = loadData;

    </script>
</body>
</html>